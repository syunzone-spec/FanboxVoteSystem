<!DOCTYPE html>
<html lang="ja">
<head>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŠé¡Œç®±</title>
    <meta property="og:title" content="ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜æ‰€">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; color: #333; line-height: 1.6; }
        h2 { text-align: center; color: #444; margin-bottom: 20px; }
        
        .notice-box { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 5px; margin-bottom: 15px; font-size: 0.9em; }
        
        /* â–¼â–¼ è¿½åŠ ç®‡æ‰€ï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼ */
        .schedule-info { 
            background-color: #fff3cd; 
            border-left: 5px solid #ffc107; 
            padding: 15px; 
            margin-bottom: 25px; 
            border-radius: 4px;
            text-align: center;
        }
        .schedule-info p { margin: 5px 0; font-weight: bold; color: #856404; }
        /* â–²â–² ã“ã“ã¾ã§ â–²â–² */

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        .hint { font-size: 0.8em; color: #666; display: block; margin-bottom: 5px; }
        
        input, textarea { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        
        /* ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ */
        button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* çµæœãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
        .secondary-btn { background-color: #6c757d; margin-top: 15px; }
        .secondary-btn:hover { background-color: #5a6268; }

        #status-message { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; text-align: center; font-weight: bold; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

    <h2>ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŠé¡Œç®±</h2>

    <div class="notice-box">
        <strong>ã€å¿…ãšãŠèª­ã¿ãã ã•ã„ã€‘</strong>
        <ul>
            <li>é ‚ã„ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¸­ã‹ã‚‰ã€å¾Œæ—¥æŠ•ç¥¨ã‚’è¡Œã„ã¾ã™ï¼</li>
            <li>æŠ•ç¥¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹éš›ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã¯ã“ã¡ã‚‰ã§å¾®ä¿®æ­£ã—ã¾ã™ã€‚ç´°ã‹ã™ãã‚‹å†…å®¹ã‚„å¯¾å¿œãŒé›£ã—ã„å†…å®¹ã¯åæ˜ ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã”äº†æ‰¿ä¸‹ã•ã„ã€‚</li>
            <li>é›†è¨ˆã¯æ‰‹ä½œæ¥­ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚ã€ãªã«ã‹ã‚ã‚Œã°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã«ã¦ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚</li>
            <li>æœŸé–“ä¸­ã«åŒä¸€HNã‹ã‚‰è¤‡æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸå ´åˆã€<span class="important">æœ€å¾Œã«é€ä¿¡ã•ã‚ŒãŸå†…å®¹ã®ã¿ã‚’æœ‰åŠ¹ï¼ˆå¾Œå‹ã¡ï¼‰</span>ã¨ã—ã¾ã™ã€‚ä¿®æ­£ã—ãŸã„å ´åˆã¯å†åº¦é€ä¿¡ã—ã¦ãã ã•ã„ã€‚</li>
            <li>ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯æ™‚é–“ã‚’å¤‰ãˆã¦ãƒªãƒˆãƒ©ã‚¤ã—ã¦ãã ã•ã„ã€‚</li>
        </ul>
    </div>

	<div class="schedule-info">
        <p>ğŸ“… ãƒªã‚¯ã‚¨ã‚¹ãƒˆç· ã‚åˆ‡ã‚Šæ—¥ï¼š2026å¹´1æœˆ23æ—¥</p>
        <p>ğŸ—³ï¸ æŠ•ç¥¨é–‹å§‹æ—¥ï¼š2026å¹´1æœˆ20æ—¥ï½2026å¹´1æœˆ31æ—¥</p>
    </div>

    
	<form id="request-form">
        <div class="form-group">
            <label>ãƒãƒ³ãƒ‰ãƒ«ãƒãƒ¼ãƒ </label>
            <input type="text" id="nickname" placeholder="å…¬é–‹ã•ã‚Œã‚‹ãŠåå‰" maxlength="20" required>
        </div>

        <div class="form-group">
            <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åï¼ˆè¤‡æ•°ã‚­ãƒ£ãƒ©ã®å ´åˆã¯ä½µè¨˜ï¼‰</label>
            <input type="text" id="character" placeholder="ä¾‹: ç«‹èŠ±éŸ¿ã€èª¿ãƒ»åˆ‡æ­Œ" maxlength="30" required>
        </div>

        <div class="form-group">
            <label>ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³</label>
            <span class="hint">æœ€å¤§50æ–‡å­—ç¨‹åº¦ã€‚ç°¡æ½”ã«ãŠé¡˜ã„ã—ã¾ã™ã€‚</span>
            <input type="text" id="theme" placeholder="ä¾‹: ãƒãƒ‹ãƒ¼ãƒ»ã‚®ãƒ£ãƒ«" maxlength="50" required>
        </div>

        <button type="submit" id="submit-btn">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡</button>
    </form>

    <div id="status-message"></div>

    <script>
        // ==========================================
        // è¨­å®š: ã“ã“ã«GASã®ãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’è²¼ã‚‹
        // ==========================================
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbzNarCkSJAZ4EcFLzKJESySKByFFsa-pAk2fDLZ-twdbIuKaqhDlnHwSZ7bkIoX1BCy6A/exec"; 

	document.addEventListener('DOMContentLoaded', () => {
            getOrCreateUUID();
            // HNã®è‡ªå‹•å…¥åŠ›
            const savedName = localStorage.getItem('gacha_user_name');
            if (savedName) document.getElementById('nickname').value = savedName;
        });

        document.getElementById('request-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('submit-btn');
            const msgDiv = document.getElementById('status-message');
            
            btn.disabled = true;
            btn.innerText = "é€ä¿¡ä¸­...";
            msgDiv.style.display = 'none';

            try {
                const ip = await getIpAddress();
                const nickname = document.getElementById('nickname').value;
                
                // HNã‚’æ¬¡å›ç”¨ã«ä¿å­˜
                localStorage.setItem('gacha_user_name', nickname);

                const formData = {
                    action: 'submit_request',
                    pixiv_id: '', // ç©ºæ–‡å­—ã§é€ä¿¡
                    nickname: nickname,
                    character: document.getElementById('character').value,
                    theme: document.getElementById('theme').value,
                    attributes: '',
                    ip_address: ip,
                    user_agent: navigator.userAgent,
                    device_uuid: getOrCreateUUID(),
                    screen_info: `${window.screen.width}x${window.screen.height}`
                };

                const response = await fetch(GAS_API_URL, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showMessage('success', 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚');
                    document.getElementById('character').value = '';
                    document.getElementById('theme').value = '';
                } else {
                    throw new Error(result.message || 'Unknown error');
                }

            } catch (error) {
                console.error(error);
                showMessage('error', 'é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡";
            }
        });

        async function getIpAddress() {
            try { const res = await fetch('https://api.ipify.org?format=json'); const data = await res.json(); return data.ip; } catch (e) { return "unknown"; }
        }

        function getOrCreateUUID() {
            const KEY = 'gacha_device_uuid';
            let uuid = localStorage.getItem(KEY);
            if (!uuid) {
                uuid = crypto.randomUUID ? crypto.randomUUID() : 'xxxxxxxx-xxxx'.replace(/[xy]/g, c => {var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});
                localStorage.setItem(KEY, uuid);
            }
            return uuid;
        }

        function showMessage(type, text) {
            const div = document.getElementById('status-message');
            div.className = type;
            div.innerText = text;
            div.style.display = 'block';
        }
    </script>
</body>
</html>



