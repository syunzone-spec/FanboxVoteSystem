<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·®åˆ†ãƒªã‚¯ã‚¨ã‚¹ãƒˆæŠ•ç¥¨çµæœ</title>
    
    <meta property="og:title" content="å·®åˆ†ãƒªã‚¯ã‚¨ã‚¹ãƒˆæŠ•ç¥¨çµæœ">
    <meta property="og:description" content="ç¾åœ¨ã®æŠ•ç¥¨é †ä½ï¼ˆé€Ÿå ±ï¼‰">
    <meta property="og:type" content="article">
    <meta name="twitter:card" content="summary_large_image">

    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; text-align: center; color: #333; line-height: 1.6; background-color: #f9f9f9; }
        
        .container { padding: 25px; border-radius: 12px; border: 1px solid #ddd; background: #fff; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h2 { color: #28a745; margin-top: 0; margin-bottom: 10px; }
        
        /* ã‚°ãƒ©ãƒ•ã‚¹ã‚¿ã‚¤ãƒ« */
        .result-row { margin-bottom: 15px; text-align: left; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .result-row:last-child { border-bottom: none; }
        .result-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px; }
        .char-name { font-weight: bold; font-size: 1.1em; }
        .char-theme { font-size: 0.85em; color: #666; margin-left: 5px; }
        .vote-count { font-weight: bold; font-size: 1.1em; color: #28a745; }
        .result-bar-bg { background: #f0f0f0; height: 12px; border-radius: 6px; overflow: hidden; width: 100%; }
        .result-bar-fill { background: linear-gradient(90deg, #28a745, #218838); height: 100%; width: 0%; transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); }
        
        /* é †ä½ãƒãƒƒã‚¸ */
        .rank-badge { display: inline-block; width: 24px; height: 24px; line-height: 24px; text-align: center; border-radius: 50%; background: #eee; font-size: 0.8em; font-weight: bold; margin-right: 5px; }
        .rank-1 { background: #ffd700; color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }
        .rank-2 { background: #c0c0c0; color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }
        .rank-3 { background: #cd7f32; color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }

        .loading { color: #888; font-style: italic; padding: 20px; }
        .error-msg { color: #dc3545; background: #ffe6e6; padding: 10px; border-radius: 5px; }
        button.reload-btn { background: transparent; border: 1px solid #ccc; padding: 5px 15px; border-radius: 4px; color: #666; cursor: pointer; margin-top: 10px; font-size: 0.8em; }
        button.reload-btn:hover { background-color: #eee; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ“Š å·®åˆ†æŠ•ç¥¨çµæœ</h2>
        <p style="font-size:0.85em; color:#888; margin-bottom:20px;">
            â€»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ä¸­ <br>
            <button onclick="location.reload()" class="reload-btn">â†» æœ€æ–°æƒ…å ±ã«æ›´æ–°</button>
        </p>

        <div id="ranking-list">
            <div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… GASã®URLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â˜…â˜…â˜…
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbzNarCkSJAZ4EcFLzKJESySKByFFsa-pAk2fDLZ-twdbIuKaqhDlnHwSZ7bkIoX1BCy6A/exec";

        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('ranking-list');

            try {
                // variant_results ãƒ¢ãƒ¼ãƒ‰ã§APIã‚’å©ãï¼ˆèªè¨¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—ï¼‰
                const res = await fetch(`${GAS_API_URL}?mode=variant_results`);
                const json = await res.json();

                if (json.status === 'success') {
                    renderResults(json.data.results);
                } else if (json.status === 'maintenance') {
                    container.innerHTML = `<div style="padding:20px;">
                        <h3 style="color:#ffc107;">ğŸš§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­</h3>
                        <p>${json.message.replace(/\n/g, '<br>')}</p>
                    </div>`;
                } else {
                    container.innerHTML = `<div class="error-msg">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>${json.message || ''}</div>`;
                }
            } catch (e) {
                console.error(e);
                container.innerHTML = `<div class="error-msg">é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚<br>æ™‚é–“ã‚’ãŠã„ã¦å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</div>`;
            }
        });

        function renderResults(ranking) {
            const container = document.getElementById('ranking-list');
            container.innerHTML = "";
            
            if (!ranking || ranking.length === 0) {
                container.innerHTML = "<p>ã¾ã æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
                return;
            }

            const maxVote = ranking[0].count > 0 ? ranking[0].count : 1;

            ranking.forEach((item, index) => {
                const percent = (item.count / maxVote) * 100;
                const rank = index + 1;
                
                let badgeClass = "rank-badge";
                if (rank === 1) badgeClass += " rank-1";
                else if (rank === 2) badgeClass += " rank-2";
                else if (rank === 3) badgeClass += " rank-3";

                const div = document.createElement('div');
                div.className = 'result-row';
                div.innerHTML = `
                    <div class="result-header">
                        <div>
                            <span class="${badgeClass}">${rank}</span>
                            <span class="char-name">${esc(item.character)}</span>
                            <span class="char-theme">${esc(item.theme)}</span>
                        </div>
                        <span class="vote-count">${item.count}<small style="font-size:0.7em; color:#888;">ç¥¨</small></span>
                    </div>
                    <div class="result-bar-bg">
                        <div class="result-bar-fill" style="width: ${percent}%;"></div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function esc(s) { return s ? s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) : ""; }
    </script>
</body>
</html>